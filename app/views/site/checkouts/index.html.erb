<% @title = "Choose a delivery address"; %>
<%- @breadcrumbs = "#{link_to "Home", root_url} &raquo; Checkout &raquo; Delivery Details" -%>
<% @class = "no-padding" %>
<% unless @cart.items.blank? %>
    <div id="header" class="green-heading-with-border">Delivery details</div>
    <div class="delivery-detail-wrapper">
      <div class="checkout-sub-heading">Delivery and Billing Address (if different from account)</div>
      <div class="checkout-des bottom-50">Your order will be delivered to the address below.</div>
      <div class="select-address clearfix">
        <div class="address-label">To use a different address please select here:</div>
        <div class="address-select">
          <%= select :ship_address, :id, options_for_shipping_addresses(current_user) %>
        </div>
      </div>
      <div class="shipping-address clearfix">
        <%= form_tag site_ship_addresses_path, :id => "ship_address_form", :protocol => "https" do %>
          <div class="col-md-8 shipping-address-box">
            <div class="shipping-title">Shipping Address</div>
            <div id="ship_address">
              <%= show_messages flash[:notice] %>
              <%= render :partial => 'site/ship_addresses/ship_address', :locals => {:ship_address => @ship_address} %>
            </div>
          </div>
        <% end %>
      </div>
      <div class="step-img"><%= image_tag("cart_step_2.png") %></div>
      <div class="top-30 right-align bottom-50">
        <div class="back-btn green-button">
          <%= link_to ("Back"),:controller=>'cart',:action=>'gift_options' %>
        </div>
        <div class="continue-btn green-button">
          <%= link_to ("Continue"), payment_site_checkouts_path, :id => "ship_address_form_continue" -%>
        </div>
        <%= javascript_tag "$(document).ready(function(e){ RemoteAddressFrom.setup('#{confirm_address_site_checkouts_path}') });" %>
      </div>
    </div>
    
<% end %>



<script type="text/javascript">
    $("#ship_address_id").change(function(){
        $("#loader").show();
        $.ajax({
            type: 'GET',
            url: "<%= new_site_ship_address_path -%>",
            data: {ship_address_id: $(this).val(), format: 'js'},
            cache: false,
            success: function(data){
                $("#loader").hide();
            }
        })
    })

    $("#ship_address_form_continue").click(function(e){
        if ($("#save_me:visible").attr("ship_id") == 0) {
                alert("Please fill-up and save shipping address by clicking 'Save Address' button before continue..")
                e.preventDefault()
        }

    });

</script>

