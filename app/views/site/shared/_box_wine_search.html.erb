<%- if !params[:category].blank? and Category.find(params[:category]) != nil
      @category = Category.find(params[:category])
    else
      @category = Category.find(:first,:conditions=>['LOWER(name = ?)','wine'])
    end %>    
<%- @parent = Category.find(params[:parent] || params[:category] || 'wine')  -%>

<!-- Creating form action url for wine/other-drinks index pages and their subcategory products like, white wine, red wine -->
<%- search_url ||= @category == @parent ? site_search_index_path(:id => @parent) : site_search_index_path(:id => 'other_drinks')   -%>
<%if params[:parent]%>
  <%search_url = nested_categories_url(@parent, @category)%>
<%end%>
<div class="block" id="box_wine_search">
  <%# if params[:category] == "wine" || ~ /search/ %>
  <% if params[:parent] != "other-drinks" and params[:parent_type] != 'other-drinks' and params[:category] != "other-drinks" %>
    <div class="green-heading-16">
      <%= (@product.present? && @product.root_category.present?) ? @product.root_category : "Wine" -%> Search
    </div>
  <% else %>
    <div class="green-heading-16">Other Drink Search</div>
  <% end %>
  <% form_tag search_url, :class=>'search_form'   ,:method => :get do %>
    <%= hidden_field_tag :id,@category.name.downcase if !@category.nil? %>
    <div class="left-bar-search">
      <%#= text_field_tag :text, params[:text], {:id => "search_text"} %>
      <%page = request.request_uri%>
      <%if page.include?('other')%>
        <%path = "/site/search/autocomplete_search_drinks_name"%>
        <%= hidden_field_tag :parent_type , 'other-drinks' %>
    
      <%else%>
        <%path = "/site/search/autocomplete_search_wine_name"%> 
          <%= hidden_field_tag :parent_type , 'wine' %>
    
      <%end%>
      
      <%= text_field_tag :text, '', :class=> "form-control",  "data-autocomplete"=> path , :placeholder => "Search Here", :style=>"" %>
    
      <i class="magnifier"><%= image_submit_tag "magnifier.png" %></i>
    </div>
    <div class="black-strip clearfix selected-filters" style="display: none;"></div>
    <div class="sidebar-filter-wrapper">
      <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
        <% if params[:parent] != "other-drinks" %>

          <div class="panel">
            <div class="panel-heading" role="tab" id="heading-1">
              <h4 class="panel-title">
                <a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse-1" aria-expanded="true" aria-controls="collapse-1">Mood:<i></i>
                </a>
              </h4>
            </div>
            <div id="collapse-1" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading-1">
              <div class="panel-body">
                <ul>
                  <%= hidden_field_tag :mood , '' , :class=>'field_value' %>
                  <% ([["Any",""]]+Mood.all.map{ |x| [x.name,x.id]}).each do |item| %>
                    <li><a href="#." value="<%= item[1] %>" class='field_text'> <%= item[0] %></a></li>
                    <%#= link_to "Add", "/site/cart?product_id=#{product.id}", :remote => true, :method => :post %>
                  <% end %>
                </ul>
              </div>
            </div>
          </div>
        <% end %>
        <div class="panel">
          <div class="panel-heading" role="tab" id="headingTwo">
            <h4 class="panel-title">
              <a class="" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">Region:<i></i></a>
            </h4>
          </div>
          <div id="collapseTwo" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingTwo">
            <div class="panel-body">
              <ul>
                <% if !@category.nil? %>
                  <%= hidden_field_tag :region_id , '' , :class=>'field_value' %>
                  <% @category.products.regions.inject([["Any", ""]]) {|rs, r| rs << [r.name, r.id]}.each do |item|  %>
                  <li><a href="#." value="<%= item[1] %>" class='field_text'> <%= item[0] %></a></li>
                  <% end %>
                <% end %>
              </ul>
            </div>
          </div>
        </div>
        <div class="panel">
          <div class="panel-heading" role="tab" id="headingThree">
            <h4 class="panel-title">
              <a class="" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree"> Grape:<i></i></a>
            </h4>
          </div>
          <div id="collapseThree" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingThree">
            <div class="panel-body">
              <ul>
                <% if !@category.nil? %>
                  <%= hidden_field_tag :grape_id , '', :class=>'field_value' %>
                  <% @category.products.grapes.inject([["Any", ""]]) {|gs, g| gs << [g.name.include?("Avola") ? "Nero d' Avola": g.name, g.id]}.each do |item| %>
                  <li><a href="#." value="<%= item[1] %>" class='field_text'>  <%= item[0] %></a></li>
                  <% end %> 
                <% end %>
              </ul>
            </div>
          </div>
        </div>
        <div class="panel">
          <div class="panel-heading" role="tab" id="headingFour">
            <h4 class="panel-title">
              <a class="" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseFour" aria-expanded="false" aria-controls="collapseFour">Colour: <i></i></a>
            </h4>
          </div>
          <div id="collapseFour" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingFour">
            <div class="panel-body">
              <ul>
                <% unless Product.all.blank? %>
                  <%= hidden_field_tag :color , '', :class=>'field_value' %>
                    <% Product.colors(@category).each do |item| %>
                    <li><a href="#." value="<%= item[1] %>" class = 'field_text'>  <%= item[0] %></a></li>
                  <% end %>
                <% end %>
              </ul>
            </div>
          </div>
        </div>
        <div class="panel">
          <div class="panel-heading" role="tab" id="headingFive">
            <h4 class="panel-title">
              <a class="" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseFive" aria-expanded="false" aria-controls="collapsefive">
                Producer: <i></i>
              </a>
            </h4>
          </div>
        </div>
        <div id="collapseFive" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingFive">
          <div class="panel-body">
            <ul>
              <% if !@category.nil? %>
                <%= hidden_field_tag :producer_id , '',  :class=>'field_value' %>
                <% @category.products.producers.inject([["Any", ""]]) { |ps, p| ps << [p.name, p.id]}.each do |item| %>
                <li><a href="#." value="<%= item[1] %>" class="field_text" >  <%= item[0] %></a></li>
                <% end %>
              <% end %>
            </ul>
          </div>
        </div>
        <div class="panel">
          <div class="panel-heading" role="tab" id="headingSix">
            <h4 class="panel-title">
              <a class="" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseSix" aria-expanded="false" aria-controls="collapseSix">
                Organic: <i></i>
              </a>
            </h4>
          </div>
          <div id="collapseSix" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingSix">
            <div class="panel-body">
              <ul>
                <li>
                  <span><% checked = (params[:organic] == 'organic') ? true : false %>
                  <%= check_box_tag :organic, 'organic',checked  %></span> 
                  <span>Organinc</span>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="panel">
          <div class="panel-heading" role="tab" id="headingSeven">
            <h4 class="panel-title">
              <a class="" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseSeven" aria-expanded="false" aria-controls="collapseSix">
                Vegan: <i></i>
              </a>
            </h4>
          </div>
          <div id="collapseSeven" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingSeven">
            <div class="panel-body">
              <ul>
                <li>
                  <span><% checked = (params[:vegetarian] == 'vegetarian') ? true : false %>
                  <%= check_box_tag :vegetarian, 'vegetarian', checked  %></span> 
                  <span>Vegan</span>
                </li>
              </ul>
            </div>
          </div>
        </div>
        
      </div>
    </div>
    <%=render partial: 'site/shared/range_slider' %>
  <% end %>

</div>
<script src="/javascripts/mine.js" type="text/javascript"></script>
<%=render partial: 'site/shared/range_slider_values_programatically' %>
