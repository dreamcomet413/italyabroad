<%- @title = "#{@my_profile ? "My" : @user.name+"'s"} Profile" -%>
<%- @breadcrumbs = "#{link_to "Home", root_url} &raquo #{@title}" -%>
<% @class = "no-padding" %>

<div id="header"><%= @title %></div>
<div class="profile-container">
  <table width="100%" cellpadding="0" cellspacing="0">
    <tr>
      <td valign="top" width="98px" style='text-align:center;'>
        <%= avatar_for_user(@user) %><br />
        <% unless @my_profile %>
        <%- if @user.followed_by?(current_user) -%>
        <%= link_to image_tag("buttons/unfollow.png"), unfollow_path(@user) %>
        <%- else -%>
        <%= link_to image_tag("buttons/follow.png"), follow_path(@user) %>
        <%- end -%>
        <% end %>
      </td>
      <td valign="top">
        <div style="margin-left:20px;">
          <div style="font-size:18px;"><%= @user.name %></div>
          <table cellpadding="0" cellspacing="0">
            <tr>
              <td><p><%= "#{@my_profile ? "My" : @user.name+"'s"}" %> favorite Meal:&nbsp;</p></td>
              <td>
                <%- if @my_profile -%>
                <div id="favorite_meal">
                  <%- form_for :user, :url => customer_path(@user), :html => {:method => :put} do -%>
                    <%= text_field :user,:fav_meals,:size => 45 %> <%= submit_tag("Save") %> or <%= link_to("Cancel", '', :onclick=>"document.getElementById('favorite_meal').style.display = 'none';return false;") %>
                  <%- end -%>
                  </div>
                <%- end -%>
              </td>
            </tr>
            <tr>
              <td><p><%= "#{@my_profile ? "My" : @user.name+"'s"}" %> favorite Wine:&nbsp;</p></td>
              <td>
                <%- if @my_profile -%>
                 <div id="favorite_wine">
                  <%- form_for :user, :url => customer_path(@user), :html => {:method => :put} do -%>
                    <%= text_field :user,:fav_wine, :size => 45 %> <%= submit_tag("Save") %> or <%= link_to("Cancel", '', :onclick=>"document.getElementById('favorite_wine').style.display = 'none';return false;") %>
                  <%- end -%>
                  </div>
                <%- end -%>
              </td>
            </tr>
            <tr>
              <td><p><%= "#{@my_profile ? "My" : @user.name+"'s"}" %> favorite Holiday:&nbsp;</p></td>
              <td>
                <%= @user.holidays rescue "No holiday" %> <%= link_to("Edit") if @my_profile && !@user.holidays.blank? %>
                <%- if @my_profile -%>
                <div id="favorite_holiday">
                  <%- form_for :user, :url => customer_path(@user), :html => {:method => :put} do -%>
                    <%= text_field :user, :holidays, :size => 45 %> <%= submit_tag("Save") %> or <%= link_to("Cancel", '', :onclick=>"document.getElementById('favorite_holiday').style.display = 'none';return false;") %>
                  <%- end -%>
                </div>
                <%- end -%>
              </td>
            </tr>
            <tr>
              <td><p><%= "#{@my_profile ? "My" : @user.name+"'s"}" %> favorite Song:&nbsp;</p></td>
              <td>
                <%= @user.songs rescue "No song" %> <%= link_to("Edit") if @my_profile && !@user.songs.blank? %>
                <%- if @my_profile -%>
                <div id="favorite_song">
                  <%- form_for :user, :html => {:method => :put} do -%>
                    <%= text_field :user, :songs, :size => 45 %> <%= submit_tag("Save") %> or <%= link_to("Cancel",'', :onclick=>"document.getElementById('favorite_song').style.display = 'none';return false;") %>
                  <%- end -%>
                </div>
                <%- end -%>
              </td>
            </tr>
            <tr>
              <td><p><%= "#{@my_profile ? "My" : @user.name+"'s"}" %> favorite Film:&nbsp;</p></td>
              <td>
                <%= @user.films rescue "No film" %> <%= link_to("Edit") if @my_profile && !@user.films.blank? %>
                <%- if @my_profile -%>
                <div id="favorite_film">
                  <%- form_for :user, :url => customer_path(@user), :html => {:method => :put} do -%>
                    <%= text_field :user, :films, :size => 45 %> <%= submit_tag("Save") %> or <%= link_to("Cancel",'', :onclick=>"document.getElementById('favorite_film').style.display = 'none';return false;") %>
                  <%- end -%>
                </div>
                <%- end -%>
              </td>
            </tr>
            <tr>
              <td><p><%= "#{@my_profile ? "My" : @user.name+"'s"}" %> favorite Newspaper:&nbsp;</p></td>
              <td>
                <%= @user.newspapers rescue "No newspaper" %> <%= link_to("Edit") if @my_profile && !@user.newspapers.blank? %>
                <%- if @my_profile -%>
                <div id="favorite_newspaper">
                <%- @display = "none" unless @user.newspapers.blank? -%>
                <div id="favorite_newspaper" style="display:<%= @display %>;">
                  <%- form_for :user, :url => customer_path(@user), :html => {:method => :put} do -%>
                    <%= text_field :user, :newspapers, :size => 45 %> <%= submit_tag("Save") %> or <%= link_to("Cancel",'', :onclick=>"document.getElementById('favorite_newspaper').style.display = 'none';return false;") %>
                  <%- end -%>
                </div>
                <%- end -%>
              </td>
            </tr>
          </table>
        </div>
      </td>
    </tr>
  </table>
  <br />
  <br />
  <div style="clear:both;"></div>
  <ul class="profile-list-info">
    <li>
      <h1><%= "#{@my_profile ? "My" : @user.name+"'s"}" %> Comments</h1>
      <ul>
        <%- @user.comments.all(:order=>' id desc',:limit => 5).each do |comment| -%>
        <li><%= comment.name unless comment.name.blank? %></li>
        <%- end -%>
        <% if @user.comments.size > 5 %>
        <li style="list-style:none;text-align:right;margin-top:20px;"><%= link_to("more",:controller=>'comments',:action=>'index',:id=>params[:id]) %></li>
        <% end %>
      </ul>
    </li>

    <li>
      <h1><%= "#{@my_profile ? "My" : @user.name+"'s"}" %> Latest Reviews</h1>
      <ul>
        <%- @user.reviews.all(:order=>' id desc',:limit => 5).each do |review| -%>
        <li><%= review.name unless review.name.blank? %></li>
        <%- end -%>
        <% if @user.reviews.size > 5 %>
        <li style="list-style:none;text-align:right;margin-top:20px;"><%= link_to("more",reviews_path) %></li>
        <% end %>
      </ul>
    </li>
    <li>
      <h1><%= "#{@my_profile ? "My" : @user.name+"'s"}" %> Winelist</h1>
      <ul>
        <%- @user.wine_lists.all(:order=>' id desc',:limit => 5).each do |wine_list| -%>
        <li><%= wine_list.product.name %></li>
        <%- end -%>
        <% if @user.wine_lists.size > 5 %>
        <li style="list-style:none;text-align:right;margin-top:20px;"><%= link_to("more",wine_lists_path) %></li>
        <% end %>
      </ul>
    </li>
  </ul>
  <div style="clear:both;"></div>

   <div>
      <h1><%= "#{@my_profile ? "My" : @user.name+"'s"}" %> Messages</h1>
      <ul>
        <%- @user.messages.all(:order=>' id desc',:limit => 5).each do |msg| -%>
        <li><%= msg.name unless msg.name.blank? %></li>
        <%- end -%>
        <% if @user.messages.size > 5 %>
        <li style="list-style:none;text-align:right;margin-top:20px;"><%= link_to("more",:controller=>'site/messages',:action=>'index',:id=>params[:id]) %></li>
        <% end %>
      </ul>
  </div>
   <%# if logged_in? %>
  <% unless @my_profile %>
  <div>
    <h1><%= "#{@my_profile ? "My" : @user.name+"'s"}" %> wall - write a Message:</h1>
      <%= render(:partial => 'site/messages/new') %>

  </div>
  <% end
  #end
  %>
</div>

<div id="follower">
  <h1>People on following:</h1>
  <ul>
    <%- @user.followers.all(:limit => 10).each do |people| -%>
    <li>
      <%= link_to avatar_for_user(people.follower, 'small'), customer_path(people.follower) %>
      <%= link_to people.follower.name, customer_path(people.follower) %>
    </li>
    <%- end -%>
  </ul>
</div>
<div style="clear:both;"></div>
<br /><br /><br />

<%- content_for :right do -%>
  <%= render :partial => 'site/shared/box_subscriptions' %>
  <br />
  <%= render :partial => 'site/shared/box_wine_tours' %>
<%- end -%>

